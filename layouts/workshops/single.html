{{ define "main" }}
<article class="workshop">

    <div class="lede">

        {{ with .Resources.GetMatch "thumb.*" }}
            {{ $image := .Fill "800x600 q75" }}
            <figure class="lede__image-container">
                <img class="lede__image" src="{{ .Permalink }}" role="presentation">
            </figure>
        {{ end }}

        <header class="lede__header">
            <h1 class="lede__heading">{{ .Title }}</h1>
            <div class="lede__summary">
                {{ .Summary }}
            </div>
        </header>

    </div>

    <div class="workshop__layout">

        <aside class="workshop__aside">
            {{ $id := path.Dir .RelPermalink }}
            {{ $now := now.Format "2006-01-02" }}
            {{ $workshops_in_language := where .Site.Data.workshops "lang" (print .Language) }}
            {{ $relevant_workshops := where ($workshops_in_language) "id" $id }}
            {{ $upcoming_workshops := where ($relevant_workshops) "date" "ge" $now }}
            {{ $past_workshops := where ($relevant_workshops) "date" "lt" $now }}

            <section class="workshop-info">
                {{ with index $upcoming_workshops 0 }}
                    <ul class="workshop-info__list">
                        <li class="workshop-info__item"><strong class="workshop-info__heading">Nejbližší termín</strong> {{ (time .date).Format (i18n "dateFormat") }}, {{ .hours }}</li>
                        <li class="workshop-info__item"><strong class="workshop-info__heading">Místo konání</strong> {{ .location | safeHTML }}</li>
                        <li class="workshop-info__item"><strong class="workshop-info__heading">Cena</strong> {{ .price | safeHTML }}</li>
                    </ul>
                    <a href="{{ .url }}" class="button workshop-info__register">Registrovat</a>
                    <p class="workshop-info__desc">Registraci a organizaci školení zajišťuje Root.cz.</p>
                {{ end }}
            </section>

            <section class="workshops-dates">
                <h2 class="workshops-dates__heading">Termíny</h2>
                <ul class="workshops-dates__list">
                    {{ range $relevant_workshops }}
                        {{ $is_past := lt .date $now }}
                        <li class="workshops-dates__item {{ if $is_past }}workshops-dates__item--past{{ end }}">{{ (time .date).Format (i18n "dateFormat") }}</li>
                    {{ end }}
                </ul>
            </section>

        </aside>

        {{ $dropcap := substr (index (split .Content "<p>") 2) 0 1 }}
        <div class="content content--longform workshop__content" data-drop-cap="{{ $dropcap }}">
            {{ .Content }}
        </div>

    </div>

</article>
{{ end }}