<!-- .slide: class="title" data-background="#F5D76E" -->
# <span>Praktick√Ω</span> <span>JavaScript</span>

---

[adam.havel@protonmail.com](mailto:adam.havel@protonmail.com)
<!-- .element: style="text-align: center" -->

---

- [https://www.adamhavel.cz/prakticky-javascript](https://www.adamhavel.cz/prakticky-javascript)
- [https://repl.it](https://repl.it)

---

## Co je c√≠lem?
- z√≠skat **p≈ôehled** o modern√≠m v√Ωvoji v JavaScriptu
- pochopit z√°kladn√≠ **koncepty**
- osvojit si konkr√©tn√≠ **postupy**
- zkusit je **pou≈æ√≠t**

---

## Co naopak c√≠lem nen√≠?
- podat **objektivn√≠** v√Ωƒçet v≈°ech mo≈ænost√≠
- vysvƒõtlit **v≈°echny** detaily
- zapamatovat si **syntax**
- zab√Ωvat se do hloubky **frameworky**

---

## Ide√°ln√≠ p≈ôedstava programu
1. princip postupn√©ho vylep≈°en√≠ (+ p≈ô√≠klad)
2. n√°stroje a automatizace (+ p≈ô√≠klad)
3. organizace k√≥du a moduly (+ p≈ô√≠klad)
4. obƒõd
5. frameworky a univerz√°ln√≠ aplikace (+ p≈ô√≠klad)
6. progresivn√≠ webov√© aplikace

=== <!-- .slide: class="section" data-background="#F5D76E" -->

# Princip postupn√©ho vylep≈°en√≠

---

### JavaScript I.

- imperativn√≠
- komplikovan√Ω
- nedeterministick√© prost≈ôed√≠ prohl√≠≈æeƒçe
- nutn√© st√°hnout a zpracovat cel√Ω skript
- nejdra≈æ≈°√≠ typ dat s ohledem na CPU

---

### JavaScript II.

- valid√°tor zastav√≠ bƒõh k√≥du v momentƒõ, kdy naraz√≠ na nezn√°m√Ω prvek:

```js
leet foo = "bar";
// SyntaxError: Unexpected identifier
```

- chybƒõj√≠c√≠ statick√° typov√° kontrola a *runtime* chyby:

```js
function awesomeSplit(str) {
  return str.toUpperCase().split('');
}

awesomeSplit(10);
// TypeError: str.toUpperCase is not a function
```

---

### JavaScript III.

**U≈æivatel√© bez JavaScriptu:**
- explicitnƒõ **vypnut√Ω** v prohl√≠≈æeƒçi
- **ne√∫spƒõ≈°n√Ω** HTTP po≈æadavek (*firewall*, *timeout*, atd.)
- **manipulace** na stranƒõ ISP, oper√°tora, hostingu, atd.
- **ro≈æ≈°√≠≈ôen√≠** v prohl√≠≈æeƒçi (*AdBlock*¬†ap.)
- chybƒõj√≠c√≠ **podpora** v prohl√≠≈æeƒçi
- *runtime*¬†**chyba**
---

## Nepou≈æ√≠vat JavaScript?!

---

### HTML I.

- deklarativn√≠
- jednoduch√©
- laxn√≠ valid√°tor
- prohl√≠≈æeƒç ignoruje, co nezn√°
- umo≈æ≈àuje postupn√© vykreslen√≠
- nezbytn√©

---

### HTML II.

```html
<html>
    <head>
        <title>HTML is resilient</title>
        <meta name="author" value="Tim Berners-Lee">
    </head>
    <body>
        <section>
            <p>Lorem ipsum dolor sit emet.
        </Section>
    </body>
</html>
```

---

### HTML III.

**Postel≈Øv z√°kon (Princip odolnosti):**

<img src="img/postel.jpg" style="float: left; width: 40%; margin-right: 1em">

*‚ÄûBe conservative in what you send; be liberal in what you accept.‚Äú*

---

### HTML IV.

```html
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>XHTML is fragile</title>
        <meta name="author" value="Tim Berners-Lee">
    </head>
    <body>
        <section>
            <p>Lorem ipsum dolor sit emet.
        </Section>
    </body>
</html>
```

---

### HTML V.

<img src="img/xhtml.png">

---

### Princip postupn√©ho vylep≈°en√≠ I.

- pou≈æ√≠v√°t JavaScript, ale **nespol√©hat** na nƒõj
- oddƒõlit **obsah** od JavaScriptu
- spr√°vnƒõ pracovat se **strukturou** a **s√©mantikou** dokumentu
- i styly jsou **vylep≈°en√≠**
- vyu≈æ√≠t funkcionality HTML (odkazy, formul√°≈ôe)

---

### Princip postupn√©ho vylep≈°en√≠ II.

```html
<form action="/search" class="js-form">
    <label for="search">Hledat</label>
    <input
        type="text"
        id="search"
        name="q"
        required
        pattern=".{3,}"
    />
    <button name="type" value="normal">Search</button>
    <button name="type" value="lucky">
        I'm feeling lucky
    </button>
</form>
```

---

### Princip postupn√©ho vylep≈°en√≠ III.

```js
formEl.addEventListener('submit', function(ev) {
    ev.preventDefault();
    let body = new FormData(this);
    let isLucky = body.get('type') === 'lucky';
    fetch(this.getAttribute('action'), {
        method: 'POST', body,
        headers: { 'Accept': 'application/json' }
    })
        .then(res => res.json())
        .then(res => {
            if (isLucky) return window.location(res[0].url);
            ...
        });
});
```

---

### Princip postupn√©ho vylep≈°en√≠ IV.

*Minimum Viable Experience:*

1. identifikovat **z√°kladn√≠** funkcionalitu
2. pou≈æ√≠t **nejjednodu≈°≈°√≠** mo≈ænou technologii pro jej√≠ zprovoznƒõn√≠
3. **vylep≈°it**, jak je libo

---

### Princip postupn√©ho vylep≈°en√≠ V.

P≈ô√≠klad na slu≈æbƒõ typu *Google Docs:*

1. `form`, `textarea` a `button`
2. automatick√© odesl√°n√≠ p≈ôes AJAX
3. z√°loha v `localStorage`
4. podpora v√≠ce u≈æivatel≈Ø skrze `WebSocket`

---

### Princip postupn√©ho vylep≈°en√≠ VI.

Stejn√Ω p≈ô√≠stup volit i v CSS:

```js
document.documentElement.classList.add('js');
```

```scss
.accordion {
    ...
}

.js .accordion:not(.is-active) {
    display: none;
}
```

---

### Princip postupn√©ho vylep≈°en√≠ VII.

<div style="margin-top: 5em; display: flex; justify-content: space-between; font-size: .5em; text-align: center">

<div style="width: 32%">
    .accordion
    <img src="img/accordion3.png">
</div>

<div style="width: 32%" class="fragment">
    .js .accordion
    <img src="img/accordion1.png">
</div>

<div style="width: 32%" class="fragment">
    .js .accordion.is-active
    <img src="img/accordion2.png">
</div>

</div>

---

### Princip postupn√©ho vylep≈°en√≠ VIII.

- postupn√© vylep≈°en√≠ nen√≠ *fallback*
- jde o **zmƒõnu p≈ô√≠stupu** p≈ôi n√°vrhu a tvorbƒõ aplikace
- na prvn√≠ pohled v√≠ce pr√°ce, opak je pravdou
- m√°me jistotu, ≈æe aplikace **v≈ædy funguje**
- automaticky z√≠sk√°me **univerz√°ln√≠ podporu** pro v≈°echny prohl√≠≈æeƒçe

---

### Detekce prost≈ôed√≠ I.

- web nen√≠ *bin√°rn√≠* platforma jako *iOS* nebo *Android*, ale obrovsk√° mno≈æina konfigurac√≠: kombinac√≠ **za≈ô√≠zen√≠** a **prost≈ôed√≠**
- nen√≠ mo≈æn√© vytvo≈ôit jednotn√Ω z√°≈æitek
- aplikace mus√≠ b√Ωt **‚Äûresponzivn√≠‚Äú**

---

### Detekce prost≈ôed√≠ II.

Jak p≈ôistoupit k detekci prost≈ôed√≠?

- nezji≈°≈•ujeme, o jak√© **prost≈ôed√≠** jde (`User-Agent`):
```js
if (navigator.userAgent.indexOf('Chrome') !== -1) {
    var myMap = new Map();
    // ReferenceError: Map is not defined.
}
```

- pt√°me se, jak√© m√° **vlastnosti**:
```js
if ('fetch' in window) {
    fetch('https://example.com').then(response => {
        // No worries.
    });
}
```

---

### Detekce prost≈ôed√≠ III.

- podpora podle **skuteƒçn√Ωch u≈æivatel≈Ø** dle **mƒõ≈ôen√≠**
- pokud m√° 90&nbsp;% u≈æivatel≈Ø modern√≠ prohl√≠≈æeƒç, ned√°v√° smysl 50&nbsp;% ƒçasu vƒõnovat zb√Ωvaj√≠c√≠m 10&nbsp;%
- aplikovat **Paretovo pravidlo**

<img src="img/analytics.png" style="width: 40%;">
<img src="img/analytics2.png" style="width: 40%;">

---

### Detekce prost≈ôed√≠ IV.

Jak rozli≈°it, kter√Ωm prohl√≠≈æeƒç≈Øm pos√≠lat JavaScript a kter√Ωm ne?

- pt√°t se na vlastnosti, p≈ôes kter√© ‚Äûnejede vlak‚Äú (*cutting the mustard*)

```js
if (
    !document.querySelector
    || !window.localStorage
    || !('classList' in document.createElement('_'))
) {
    return false;
}

document.documentElement.classList.add('js');
// ...
```

---

### Detekce prost≈ôed√≠ V.

Jak√© vlastnosti vybrat?

- `querySelector` (‚úù *Internet Explorer 7*)
- `addEventListener` (‚úù *Internet Explorer 8*)
- `classList` (‚úù *Internet Explorer 9*)
- `Object.assign` (‚úù *Internet Explorer 11*)
- `localStorage` (‚úù *Opera Mini*)

---

### Detekce prost≈ôed√≠ VI.

```html
<script src="js/scout.js" defer></script>
```

```js
// scout.js
(function() {
    if (
        !document.querySelector
        || !window.localStorage
        || !('classList' in document.createElement('_'))
    ) {
        return false;
    }

    document.documentElement.classList.add('js');
    fetch('js/app.js');
})();
```

**Probl√©m:** *Internet Explorer 10* a *11* nepodporuj√≠ `fetch`.
<!-- .element: class="fragment" -->

---

### *Polyfilling* I.

- *polyfilly* umo≈æ≈àuj√≠ pou≈æ√≠t API, kter√© prohl√≠≈æeƒç nepodporuje
- **p≈ô√≠klad:** `Promise`, `fetch`, `PointerEvents`
- mo≈æn√© ≈ôe≈°en√≠ (`defer` zajist√≠ spr√°vn√© po≈ôad√≠):
```html
<script src="js/lib/promise.js" defer></script>
<script src="js/lib/whatwg-fetch.js" defer></script>
<script src="js/lib/pep.js" defer></script>
<script src="js/scout.js" defer></script>
```
- **probl√©m:** prohl√≠≈æeƒçe, kter√© API podporuj√≠, *polyfill* nepou≈æij√≠, ale mus√≠ jej st√°hnout

---

### *Polyfilling* II.

Lep≈°√≠ ≈ôe≈°en√≠ je *polyfilly* st√°hnout dle pot≈ôeby v `scout.js`:

```js
let polyfills = [
    {
        src: 'js/lib/promise.js',
        test: 'Promise' in window
    },
    {
        src: 'js/lib/whatwg-fetch.js',
        test: 'fetch' in window
    },
    {
        src: 'js/lib/pep.js',
        test: 'PointerEvent' in window
    }
];
```

---

### *Polyfilling* III.

Jednoduch√© ≈ôe≈°en√≠ pro asynchronn√≠ naƒçten√≠ skript≈Ø:

```js
function loadScript(src, callback) {
    let scriptEl = document.createElement('script');

    scriptEl.addEventListener('load', callback.bind(window));
    scriptEl.src = src;
    document.head.appendChild(scriptEl);
};
```

---

### *Polyfilling* IV.

St√°hneme jen ty *polyfilly*, kter√© jsou pot≈ôeba:

```js
let reqPolyfills = polyfills.filter(({ test }) => !test);
let counter = reqPolyfills.length;

reqPolyfills.forEach(({ src }) => {
    loadScript(src, function() {
        counter--;

        if (counter === 0) { // All polyfills loaded.
            fetch('js/app.js').then(() => {
                document.documentElement.classList.add('js');
            });
        }
    });
})
```

--- <!-- .slide: class="exercise" data-background="#b8f1fd" -->

## P≈ô√≠klad (I.) ‚Äî [odkaz](https://repl.it/@jackdaw/exercise-pj-i)

- upravte HTML, JavaScript a CSS existuj√≠c√≠ TodoList aplikace s ohledem na **princip postupn√©ho vylep≈°en√≠**
- pou≈æijte **s√©manticky** spr√°vn√© a dob≈ôe **strukturovan√©** HTML
- rozmyslete, jak bude aplikace pracovat z pohledu prohl√≠≈æeƒçe **bez JavaScriptu**
- JavaScript se spust√≠ jen pro prohl√≠≈æeƒç **Internet Explorer 9 a novƒõj≈°√≠**
- p≈ôedpokl√°dejte existuj√≠c√≠ logiku **aplikaƒçn√≠ho serveru**

=== <!-- .slide: class="section" data-background="#F5D76E" -->

# N√°stroje a automatizace

---

### *Transpiling* I.

**Probl√©m:** *polyfilly* ≈ôe≈°√≠ chybƒõj√≠c√≠ API, ale ne syntax.

```js
let reqPolyfills = polyfills.filter(({ test }) => !test);
// SyntaxError: Unexpected identifier.
```

- deklarace promƒõnn√Ωch p≈ôes `let` (‚úù *IE 10*)
- *arrow* funkce `(...) => { ... }` (‚úù *IE 11*)
- *destructuring* `({ test })` (‚úù *IE 11*)

---

### *Transpiling* II.

Transformace novƒõj≈°√≠ **syntaxe** (*ES2015+*) do podoby, kter√° je podporov√°na **specifikovanou** sadou prohl√≠≈æeƒç≈Ø.

```js
let reqPolyfills = polyfills.filter(({ test }) => !test);
```
<!-- .element: class="fragment" -->

‚¨á üòÅ *IE 10-11*
<!-- .element: class="fragment" style="text-align: center" -->

```js
var reqPolyfills = polyfills.filter(function(_ref) {
    var test = _ref.test;
    return !test;
});
```
<!-- .element: class="fragment" -->

---

### *Transpiling* III.

- [*Babel*](https://babeljs.io/) je nejpou≈æ√≠vanƒõj≈°√≠ n√°stroj na *transpiling*
- slou≈æ√≠ k transformaci k√≥du pro prohl√≠≈æeƒç i server
- z√°kladn√≠ sadu transformac√≠ urƒçuje *preset* (nap≈ô. `@babel/preset-env`)
- lze pou≈æ√≠t *presety* i pro speci√°ln√≠ syntax (`@babel/preset-react`)
- nab√≠z√≠ voliteln√© *pluginy* pro experiment√°ln√≠ syntax (*Stage 0-3* dle *Ecma TC39*) jako `@babel/plugin-proposal-decorators`

---

### *Transpiling* IV.

- podporovan√© prohl√≠≈æeƒçe lze specifikovat pomoc√≠ *browserlist* ≈ôetƒõzce:

```js
"> 2%, not dead, ie11"
```

```js
"presets": [
    [
        "@babel/preset-env",
        {
            "targets": { "browsers": "> 2%, ie 10-11" }
        }
    ],
    "@babel/preset-react"
],
"plugins": [
    "@babel/plugin-proposal-decorators",
    "@babel/plugin-proposal-class-properties"
]
```

---

### `package.json` I.

Z√°vislosti projektu urƒç√≠me v souboru `package.json`:

```js
{
  "name": "my-app",
  "version": "0.1.0",
  "description": "My application",
  "main": "js/app.js",
  "dependencies": {
    "express": "4.15.2"
  },
  "devDependencies": {
    "autoprefixer": "9.4.4",
    "cssnano": "4.1.8",
    "eslint": "5.11.1"
  }
}
```

---  <!-- .slide: class="longform" -->

### `package.json` II.

- *npm* je spr√°vce bal√≠ƒçk≈Ø pro JavaScript (p≈Øvodnƒõ vznikl pro *Node.js*)
- `npm install` st√°hne v≈°echny z√°vislosti projektu a ulo≈æ√≠ je do slo≈æky `node_modules`
- `npm install express` st√°hne konkr√©tn√≠ bal√≠ƒçek a ulo≈æ√≠ jej do `dependencies` v `package.json`
- `npm install --save-dev eslint` st√°hne bal√≠ƒçek a ulo≈æ√≠ jej do `devDependencies`
- `npm prune --production` sma≈æe bal√≠ƒçky nepot≈ôebn√© pro bƒõh aplikace

---

### `package.json` III.

- pro pou≈æit√≠ *Babelu* mus√≠me nainstalovat bal√≠ƒçky: `@babel/core`, `@babel/preset-env` a `@babel/cli`
- nastav√≠me v `package.json`:

```js
"babel": {
    "presets": [
        [
            "@babel/preset-env",
            {
                "targets": { "browsers": "> 2%, ie 10-11" }
            }
        ]
    ]
}
```

---

### `package.json` IV.

- *transpilaci* provedeme pomoc√≠:

```bash
./node_modules/.bin/babel src/js --out-dir build/js
```

- lze pou≈æ√≠t p≈ô√≠kaz `npx` (souƒç√°st *npm*):

```bash
npx babel src/js --out-dir build/js
```

---

### `package.json` V.

- p≈ô√≠kazy nastaven√© v `package.json` automaticky hledaj√≠ v `node_modules/.bin`:

```js
"name": "my-app",
"scripts": {
    "build": "babel src/js --out-dir build/js"
},
...
```

```js
npm run build
```

---

### `package.json` VI.

- bal√≠ƒçky sta≈æen√© z ve≈ôejn√©ho *npm* registru (https://registry.npmjs.org) mohou b√Ωt nebezpeƒçn√©
- nutn√© ovƒõ≈ôit cel√Ω strom z√°vislost√≠ (viz `flatmap-stream` a `event-stream`)
- z√°vislosti je t≈ôeba **pravidelnƒõ** kontrolovat pomoc√≠ `npm audit`:

```js
npm audit
found 38 vulnerabilities (15 low, 13 moderate, 10 high)
in 1559 scanned packages
run `npm audit fix` to fix 29 of them.
```

---

### `package.json` VII.

```bash
# Run `npm update request --depth 4`
# to resolve 9 vulnerabilities
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ High    ‚îÇ Regular Expression Denial of Service            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Package ‚îÇ sshpk                                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Dep of  ‚îÇ grunt-retire [dev]                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Path    ‚îÇ grunt-retire > request > http-signature > sshpk ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Info    ‚îÇ https://nodesecurity.io/advisories/606          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### Automatizace I.

- automatizace opakovan√Ωch operac√≠ ≈°et≈ô√≠ ƒças
- **p≈ô√≠klady:**
    - *transpilace* (*JavaScript*, *TypeScript*, *Sass*, ap.)
    - *minifikace* (*JavaScript*, CSS, HTML, SVG)
    - *komprese* (obr√°zky)
    - testov√°n√≠
    - verzov√°n√≠
- **probl√©m:** prvotn√≠ investice ƒçasu a zv√Ω≈°en√° komplexita projektu

---

### Automatizace II.

- velk√© mno≈æstv√≠ n√°stroj≈Ø a p≈ô√≠stup≈Ø
- lep≈°√≠ volit nejjednodu≈°≈°√≠ mo≈æn√© ≈ôe≈°en√≠
- **p≈ô√≠klad:** `package.json`

```js
...
"scripts": {
    "build": "npm run build-js; npm run build-css",
    "build-js": "babel src/js --out-dir build/js",
    "build-css": "lessc src/css/app.less build/css/app.css"
},
...
```

```bash
npm run build
```

---

### Automatizace III.

- **probl√©m:** absence promƒõnn√Ωch, nejednotn√© rozhran√≠, nep≈ôehlednost
- v p≈ô√≠padƒõ vƒõt≈°√≠ch projekt≈Ø m≈Ø≈æou pomoci mocnƒõj≈°√≠ n√°stroje
- **p≈ô√≠klad:** `Makefile`, *task runnery*

---

### N√°stroje I.

- **spr√°vce bal√≠ƒçk≈Ø:** *npm*, *Bower*, *yarn*
- **bundlery:** *Browserify*, *webpack*, *Rollup*, *Parcel*
- **task runnery:** *Grunt*, *Gulp*
- **scaffolding:** *Slush*, *Yeoman*

---

### N√°stroje II.

**Spr√°vce bal√≠ƒçk≈Ø:**
- *npm*
    - standard
    - bal√≠ƒçky pro *Node.js* i pro prohl√≠≈æeƒç
- *Bower*
    - bal√≠ƒçky jen pro prohl√≠≈æeƒç
- *yarn*
    - stejn√Ω registr jako *npm*
    - d≈Øraz na rychlost a determinismus

---

### N√°stroje III.

**Bundlery**:
- na z√°kladƒõ tzv. *entry pointu* vytvo≈ô√≠ z jeho stromu z√°vislost√≠ **jeden soubor** (*bundle*)
- podporuj√≠ r≈Øzn√© typy **modul≈Ø** (AMD, CommonJS, ESM)
- umo≈æ≈àuj√≠ pou≈æ√≠t bal√≠ƒçky pro *Node.js* v **prohl√≠≈æeƒçi**
- pokroƒçil√© metody typu *code splitting* a *tree shaking*
- pomoc√≠ *plugin≈Ø* umo≈æ≈àuj√≠ prov√©st dal≈°√≠ **transformace** (*minifikace*, *transpilace*, ap.)

---

### N√°stroje IV.

*webpack*:

```js
npm install --save-dev webpack
```

```js
// package.json
...
"scripts": {
    "build": "webpack --config webpack.config.js"
},
...
```

```js
// webpack.config.js
module.exports = {
    mode: 'production',
    entry: './src/js/app.js',
    output: {
        filename: 'app.bundle.js',
        path: './build/js'
    }
};
```

---

### N√°stroje V.

```js
// math.js

export function square(x) {
  return x * x;
}

export function cube(x) {
  return x * x * x;
}
```

```js
// app.js

import { square } from './math.js';

console.log(`3 squared is ${square(3)}.`);
```

---

### N√°stroje VI.

```js
// ‚Äûapp.bundle.js‚Äú

function square(x) {
  return x * x;
}

console.log(`3 squared is ${square(3)}.`);
```

---

### N√°stroje VII.

Transpilace v r√°mci *webpack*:

```bash
npm install --save-dev babel-loader
```

```js
// webpack.config.js
module.exports = {
    ...
    module: {
        rules: [
            {
                loader: 'babel-loader',
                options: {
                    presets: ['@babel/preset-env']
                }
            }
        ]
    }
};
```

---

### N√°stroje VIII.

**Task runnery:**

- zjednodu≈°uj√≠ tvorbu **komplikovan√Ωch** *build* proces≈Ø
- *build* se skl√°d√° z jednotliv√Ωch *plugin≈Ø*
- *plugin* je skript napsan√Ω v JavaScriptu
- m≈Ø≈æe obalovat a vyu≈æ√≠vat zkompilovan√© programy (`node_modules/.bin`)
- zaruƒçuje **jednotn√© API** nap≈ô√≠ƒç r≈Øzn√Ωmi n√°stroji (*Babel*, *Less*, *svgo* ap.)

---

### N√°stroje IX.

*Grunt*:

```bash
npm install --save-dev grunt grunt-contrib-less grunt-postcss
```

```bash
npm install --save-dev autoprefixer
```

```js
// Gruntfile.js
module.exports = function(grunt) {

    grunt.initConfig({
        ...
    });

    grunt.loadNpmTasks('grunt-contrib-less');
    grunt.loadNpmTasks('grunt-postcss');
    grunt.registerTask('build-css', ['less', 'postcss']);
    grunt.registerTask('build', ['build-css']);
};
```

---

### N√°stroje X.

Konfigurace pluginu `grunt-contrib-less`:

```js
grunt.initConfig({
    less: {
        default: {
            options: {
                strictMath: true
            },
            src: 'src/css/default.less',
            dest: 'build/css/default.css'
        }
    }
});
```

---

### N√°stroje XI.

Konfigurace pluginu `grunt-postcss`:

```js
grunt.initConfig({
    less: { ... },
    postcss: {
        options: {
            processors: [
                require('autoprefixer')({ ... })
            ]
        },
        default: {
            src: 'build/css/default.css'
        }
    }
});
```

```bash
./node_modules/.bin/grunt build
```

---

### N√°stroje XII.

Konfigurace *webpack* pomoc√≠ pluginu `grunt-webpack`:

```bash
npm install --save-dev grunt-webpack babel-loader
```

```bash
npm install --save-dev @babel/core @babel/preset-env
```

```js
// Gruntfile.js
...
grunt.loadNpmTasks('grunt-webpack');
grunt.registerTask('build-css', ['less', 'postcss']);
grunt.registerTask('build-js', ['webpack']);
grunt.registerTask('build', ['build-css', 'build-js']);
```

---

### N√°stroje XIII.

Konfigurace pluginu `grunt-webpack`:

```js
grunt.initConfig({
    ...
    webpack: {
        mode: 'production',
        entry: './src/js/app.js',
        output: {
            filename: 'app.bundle.js',
            path: './build/js'
        },
        module: {
            rules: [{ loader: 'babel-loader', ... }]
        }
    }
});
```

---

### N√°stroje XIV.

Definice skript≈Ø v `package.json`:

```js
// package.json
...
"scripts": {
    "build": "grunt build"
},
...
```

```bash
npm run build
```

---

### N√°stroje XV.

**Automatizace** √∫kolu p≈ôi v√Ωvoji:

```bash
npm install --save-dev grunt-contrib-watch
```

```js
grunt.initConfig({
    watch: {
        css: {
            files: 'src/css/**/*.less',
            tasks: ['build-css']
        },
        js: {
            files: 'src/js/**/*.js',
            tasks: ['build-js']
        }
    }
});

grunt.registerTask('develop', ['build', 'watch']);
```
<!-- .element: class="fragment" -->

---

### N√°stroje XVI.

```js
// package.json
...
"scripts": {
    "build": "grunt build",
    "develop": "grunt develop"
},
...
```

```bash
npm run develop
```

---

### N√°stroje XVII.

*Gulp*:

```js
let gulp = require('gulp');
let less = require('gulp-less');
let postcss = require('gulp-postcss');
let autoprefixer = require('autoprefixer');

gulp.task('build-css', function(done) {
  gulp.src('./src/css/default.less')
    .pipe(less())
    .pipe(postcss([
        autoprefixer({ browsers: ['> 2%'] }
    ])
    .pipe(gulp.dest('./build/css/'))
    .on('end', done);
});
```

---

### N√°stroje XVIII.

- ka≈æd√Ω *Grunt* plugin prov√°d√≠ *I/O* nad **soubory**
- *Gulp* operuje na principu ***stream≈Ø***
- *streamy* se **≈ôetƒõz√≠** pomoc√≠ funkc√≠
- ke ƒçten√≠ a z√°pisu doch√°z√≠ jen na **zaƒç√°tku** a **konci** cel√©ho procesu
- *build* je ve v√Ωsledku **rychlej≈°√≠**
- nen√≠ t≈ôeba pro ka≈æd√Ω d√≠lƒç√≠ krok definovat **cestu** ke vstupu a v√Ωstupu
- v praxi jde sp√≠≈° o mno≈æstv√≠ *plugin≈Ø* a **preference**

--- <!-- .slide: class="exercise" data-background="#b8f1fd" -->

## P≈ô√≠klad (II.) ‚Äî [odkaz](https://repl.it/@jackdaw/exercise-pj-ii)

- pomoc√≠ `Gruntfile.js` vytvo≈ôte jednoduch√Ω *build* proces
- soubory ze slo≈æky `src` zpracujte n√°sledovnƒõ:
    - `default.less` p≈ôeveƒète do form√°tu CSS a *zminifikujte*
    - `plugin.css` *zminifikujte*
    - `script.js` *ztranspilujte* do podoby straviteln√© pro Internet Explorer 9-11 a prohl√≠≈æeƒçe s alespo≈à 5% pod√≠lem na trhu, a *zminifikujte*
    - zpracovan√© soubory pat≈ô√≠ do slo≈æky `build`, kter√° kop√≠ruje strukturu `src`
- do `package.json` dopl≈àte pot≈ôebn√© bal√≠ƒçky
- skrze `grunt.registerTask` vytvo≈ôte libovoln√© mno≈æstv√≠ p≈ô√≠kaz≈Ø, ale alespo≈à jeden s n√°zvem `build`, kter√Ω sdru≈æuje ostatn√≠ p≈ô√≠kazy

=== <!-- .slide: class="section" data-background="#F5D76E" -->

# Organizace k√≥du a moduly

---

### Proƒç moduly?

- **ƒçitelnost** k√≥du
- **oddƒõlen√≠** zodpovƒõdnost√≠
- zmƒõny na **lok√°ln√≠** √∫rovni
- **znovupou≈æit√≠** k√≥du a modul≈Ø
- lep≈°√≠ **spr√°va** z√°vislost√≠
- lep≈°√≠ **architektura** aplikace

---

## Historie

- samostatn√© skripty
- AMD (Async Module Definition)
- CommonJS
- ESM (nativn√≠ moduly)

---

### Samostatn√© skripty I.

```html
<script src="vendor/polyfill.js"></script>
<script src="lib/core.js"></script>
<script src="components/dropdown.js"></script>
<script src="components/modal.js"></script>
<script src="application.js"></script>
```

```js
// dropdown.js
var delay = 2000;
```

```js
// modal.js
var delay = 4000;
```

---

### Samostatn√© skripty II.

- Pro:
    - oddƒõlen√≠ k√≥du
    - samostatn√© soubory
‚Äã
- Proti:
    - glob√°ln√≠ kontext
    - nejednotn√©

---

### Samostatn√© skripty III.

Zapouzd≈ôen√≠ do funkce:

```js
// dropdown.js
function Dropdown(el) {
    var delay = 2000;
    var toggle = function() {
        el.classList.toggle('is-active');
    }

    return {
        delay: delay,
        toggle: toggle
    };
}
```

---

### Samostatn√© skripty III.

Zapouzd≈ôen√≠ v *IIFE*:

```js
// dropdown.js
(function Dropdown(w) {
    var delay = 2000;

    w.dropdown = {
        delay: delay
    };
})(window);
```

---

### AMD I.

```js
// dropdown.js
define(
    'components/dropdown',
    ['vendor/polyfill', 'lib/core'],
    function(core) {
        var dropdown = { delay: 2000 };
        return dropdown;
    }
);
```

```js
// application.js
define(
    ['components/dropdown', 'components/modal'],
    function(dropdown, modal) {
        ...
    }
);
```

---

### AMD II.

- Pro:
    - oddƒõlen√Ω kontext
    - znovupou≈æit√≠ modul≈Ø
    - vkl√°d√°n√≠ z√°vislost√≠ (*dependency injection*)
    - n√°stroje (*Require.js*)
‚Äã
- Proti:
    - komplikovan√° syntax
    - asynchronn√≠ z√°vislosti

---

### CommonJS I.

```js
// dropdown.js
require('../vendor/polyfill');
require('../lib/core');

var dropdown = { delay: 2000 };

module.exports = dropdown;
```

```js
// application.js
const dropdown = require('./components/dropdown');
const modal = require('./components/modal');
```

---

### CommonJS II.

- Pro:
    - oddƒõlen√Ω kontext
    - znovupou≈æit√≠ modul≈Ø
    - nativn√≠ podpora v Node.js
    - n√°stroje (*Browserify*)
‚Äã
- Proti:
    - pouze synchronn√≠ naƒçten√≠ z√°vislost√≠
    - nepodporov√°no v prohl√≠≈æeƒçi

---

### Nativn√≠ moduly I.

```js
// dropdown.js
import '../vendor/polyfill.js';
import '../lib/core.js';

export const dropdown = { delay: 2000 };
```

```js
// application.js
import { dropdown } from './components/dropdown.js';
```

---

### Nativn√≠ moduly II.

- Pro:
    - oddƒõlen√Ω kontext
    - znovupou≈æit√≠ modul≈Ø
    - mo≈ænost v√≠ce export≈Ø (pojmenovan√Ωch)
    - neblokuj√≠c√≠ import, vykonan√Ω ve spr√°vn√©m po≈ôad√≠
    - statick√Ω i dynamick√Ω import
    - standard (*EcmaScript 2015*)
    - n√°stroje (*Webpack*, *Babel*, *Rollup*)

- Proti: podpora?

---

### Nativn√≠ moduly III.

<img src="img/caniuse.png">

---

### Nativn√≠ moduly IV.

```html
<script type="module" src="module.js">
```

- atribut `type` mus√≠ b√Ωt `module`
- automaticky p≈ôedpokl√°d√° `"use strict"`
- odlo≈æen√© naƒçten√≠ (`defer`)

---

### Typy export≈Ø a import≈Ø I.

Pojmenovan√Ω export:

```js
// export.js
export const foo = 'bar';
```

```js
// export.js
const foo = 'bar';
export { foo };
```

```js
// import.js
import { foo } from './export.js';
foo; // "bar"
```

```js
// import.js
import { foo as baz } from './export.js';
baz; // "bar"
```

---

### Typy export≈Ø a import≈Ø II.

*Default* export:

```js
// export.js
export default 'bar';
```

```js
// export.js
const foo = 'bar';
export { foo as default };
```

```js
// import.js
import baz from './export.js';
baz; // "bar"
```

---

### Typy export≈Ø a import≈Ø III.

V√≠ce pojmenovan√Ωch export≈Ø:

```js
// export.js
export const Alice = { gender: 'female' };
export const Bob = { gender: 'male' };
```

```js
// import.js
import { Alice, Bob } from './export.js';
Bob.gender; // "male"
```

```js
// import.js
import * as Persons from './export.js';
Persons.Alice.gender; // "female"
```

---

### Typy export≈Ø a import≈Ø IV.

Kombinace *default* a pojmenovan√Ωch export≈Ø:

```js
// export.js
const Alice = { gender: 'female' };
const Bob = { gender: 'male' };

export { Alice as default, Bob };
```

```js
// import.js
import Person from './export.js';
Person.gender; // "female"
```

```js
// import.js
import Alice, { Bob } from './export.js';
Alice.gender; // "female"
Bob.gender; // "male"
```

---

### Typy export≈Ø a import≈Ø V.

Bez export≈Ø:

```js
// module.js
console.log('Do something useful.');
```

```js
// import.js
import './module.js'; // "Do something useful."
```

---

### Naƒçten√≠ modul≈Ø I.

- moduly jsou ‚Äûsingletony‚Äú
- naƒçtou se a vykonaj√≠ pouze **jednou**, i kdy≈æ jsou importovan√© na **v√≠ce** m√≠stech

```js
// module.js
console.log('Module loaded.');
```

```js
// foo.js
import './module.js';
```

```js
// bar.js
import './module.js';
```

```js
// "Module loaded."
```

---

### Naƒçten√≠ modul≈Ø II.

Nutn√© pou≈æ√≠t ***HTTP/2*** (kv≈Øli *multiplexingu* po≈æadavk≈Ø):

<img src="img/http2.png">

---

### Omezen√≠

- `import` a `export` nelze pou≈æ√≠t v **zano≈ôen√Ωch** bloc√≠ch
- nelze **dynamicky** vytv√°≈ôet n√°zev modulu p≈ôi importu

```js
// SyntaxError: 'import' may only appear at the top level.
if (!window.fetch) {
    import '../lib/whatwg-fetch/fetch.js';
}
```

```js
// SyntaxError: Unexpected token.
const LIB_DIR = '../lib';

import `${LIB_DIR}/whatwh-fetch/fetch.js`;
```

---

### *Hoisting*

- `import` je podobnƒõ jako `var` a `function` ‚Äûvyta≈æen‚Äú (*hoisting*) na zaƒç√°tek modulu
- po≈ôad√≠ je zachov√°no

```js
console.log(foo);
import './module1.js';
var foo = 'bar';
console.log(message);
import { message } from './module2.js';
```

```js
import './module1.js';
import { message } from './module2.js';
var foo = 'bar';
console.log(foo); // "bar"
console.log(message); // "Hoisting saves the day."
```

---

### Vzd√°len√Ω skript

```js
import 'https://example.com/module.js';
/* Access to Script at 'https://example.com/module.js'
 * from origin 'https://adamhavel.com'
 * has been blocked by CORS policy. /
```

- pozor na *CORS* (*cross-origin resource sharing*) a *same-origin policy*
- nutn√© nastavit hlaviƒçku `Access-Control-Allow-Origin` a spr√°vn√Ω *MIME* typ

```nginx
location ~* \.(?:js|mjs)$ {
    add_header Content-Type "text/javascript";
    add_header Access-Control-Allow-Origin "*";
}
```

---

### Cesta k modulu I.

```js
import Foo from '../libs/foo/dist/foo.js';
```

- mus√≠ j√≠t o **platn√© URL**
- **absolutn√≠** nebo zaƒç√≠nat na `/`, `./` nebo `../`
- vƒçetnƒõ **p≈ô√≠pony** v n√°zvu souboru
- nelze ho dynamicky vytvo≈ôit
- ne≈ôe≈°√≠ automaticky cesty typu `node_modules`

---

### Cesta k modulu II.

`packagemap` definuje vlastn√≠ cesty k modul≈Øm:

```html
<script type="packagemap" src="package-map.json"></script>
```

```html
<script type="packagemap">
{
    "path_prefix": "/node_modules",
    "packages": {
        "moment": { "main": "src/moment.js" },
        "lodash": { "path": "lodash", "main": "lodash.js" }
    }
}
</script>
```

```html
<script type="module">
    import moment from 'moment';
    import _ from 'lodash';
</script>
```

---

### Dynamick√Ω import I.

```js
const MOD_DIR = './modules';

import(MOD_DIR + '/lodash.js')
    .then(lodash => {
        const _ = lodash.default;
        let foo = _.lowerCase('FOO');
    });

const { default: _ } = await import(`${MOD_DIR}/lodash.js`);
let foo = _.lowerCase('FOO');
```

- vrac√≠ *Promise* (lze pou≈æ√≠t s `async/await`)
- hodnotou je objekt reprezentuj√≠c√≠ export modulu
- cestu lze tvo≈ôit **dynamicky**

---

### Dynamick√Ω import II.

- lze pou≈æ√≠t v jak√©koliv √∫rovni **zano≈ôen√≠** jako nap≈ô√≠klad v cyklu, podm√≠nce, ap.
- vhodn√© pro ***lazy-loading*** modul≈Ø a≈æ v momentƒõ, kdy jsou pot≈ôeba

```js
let accordionEls = document.querySelectorAll('.accordion');

if (accordionEls.length) {
    const { Accordion } = await import('./accordion.js');

    Array.from(accordionEls, el => Accordion(el));
}
```

---

### Podpora v Node.js

```bash
node --experimental-modules main.mjs
```

- **experiment√°ln√≠ podpora** p≈ôi pou≈æit√≠ p≈ô√≠znaku
- nutn√© pou≈æ√≠t p≈ô√≠ponu `.mjs` (podobnƒõ jako `type="module"` indikuje modul)
- mo≈ænost vyu≈æ√≠t *polyfill* [esm](https://github.com/standard-things/esm)

---

### Podpora v prohl√≠≈æeƒç√≠ch I.

**Dvƒõ verze aplikace:** *bundle* (`app.bundle.js`) a netranspilovan√Ω *entry point* (`app.js`)

```html
<script type="module" src="app.js"></script>
<script nomodule src="app.bundle.js"></script>
```

- prohl√≠≈æeƒçe podporuj√≠c√≠ ESM **nest√°hnou** skript s atributem `nomodule` (s vyj√≠mkou Edge)
- skript s `type="module"` je naopak **ignorov√°n** prohl√≠≈æeƒçi bez podpory
- ne≈ôe≈°√≠ probl√©m dynamick√©ho importu (*Firefox* a *Edge*)

---

### Podpora v prohl√≠≈æeƒç√≠ch II.

Transpilace pro modern√≠ prohl√≠≈æeƒçe v p≈ô√≠padƒõ pou≈æit√≠ **experiment√°ln√≠** syntaxe:

```js
"presets": [
    [
        "@babel/preset-env",
        {
            "targets": { "esmodules": true }
        }
    ]
],
"plugins": ["@babel/plugin-proposal-decorators"]
```
---

### Podpora v prohl√≠≈æeƒç√≠ch III.

- lze pou≈æ√≠t polyfill [System.js](https://github.com/systemjs/systemjs)
- nutn√° transpilace (plugin `@babel/plugin-transform-modules-systemjs`)
- umo≈æ≈àuje ESM i pro star≈°√≠ prohl√≠≈æeƒçe
- dynamick√Ω import p≈ôes `System.import`
- podpora pro `packagemap` (`systemjs-packagemap`)
- zachov√° v√Ωhodu ***lazy-loadingu***

---

### Podpora v prohl√≠≈æeƒç√≠ch IV.

```
// app.js
import { flattenDeep } from 'lodash';
```

```html
<script type="systemjs-packagemap">
{
    "path_prefix": "/node_modules",
    "packages": {
        "lodash": { "main": "lodash/lodash.js" }
    }
}
</script>
<script src="js/lib/system.js"></script>
<script>
    System.import('js/app.js');
</script>
```

--- <!-- .slide: class="exercise" data-background="#b8f1fd" -->

## P≈ô√≠klad (III.) ‚Äî [odkaz](https://repl.it/@jackdaw/exercise-pj-iii)

- upravte v p≈ô√≠kladu HTML a JavaScript tak, aby vyu≈æily **nativn√≠ch modul≈Ø**
- p≈ôepi≈°te r≈Øzn√© typy modul≈Ø do **jednotn√©ho** form√°tu
- v≈°echny skripty se mus√≠ **vykonat**
- rozmyslete, jak√Ωm zp≈Øsobem definovat `export` v `library.js` a zdali je mo≈æn√© **zkombinovat** v√≠ce postup≈Ø

=== <!-- .slide: class="section" data-background="#F5D76E" -->

# Frameworky a univerz√°ln√≠ aplikace

---

### Frameworky I.

- *framework* je **sada n√°vrhov√Ωch vzor≈Ø** (nap≈ô. *data binding* a jeho vzor *observer*)
- p≈ôedstavuje **n√°hled tv≈Ørc≈Ø** na ≈ôe≈°en√≠ konkr√©tn√≠ch probl√©m≈Ø
- nab√≠z√≠ **nemƒõnnou kombinaci postup≈Ø**
- **p≈ô√≠klady:** *AngularJS*, *React*, *Vue*, *Ember*, *Polymer*, *Angular*, *Meteor*, ...

---  <!-- .slide: class="longform" -->

### Frameworky II.

**V√Ωhody:**
- umo≈æ≈àuj√≠ **rychl√Ω** v√Ωvoj
- nemus√≠me ‚Äûvynal√©zat kolo‚Äú
- ≈ôe≈°√≠ **architekturu** aplikace
- skvƒõl√© na ***prototyping***
- nut√≠ k **doporuƒçen√Ωm postup≈Øm**
- vedou k **jednotn√©mu** stylu v√Ωvoje
- **n√°vody**, jak postupovat v bƒõ≈æn√Ωch situac√≠ch
- stav√≠ na ***open source*** komunitƒõ

---  <!-- .slide: class="longform" -->

### Frameworky III.

**Nev√Ωhody:**
- n√°vrhov√© vzory se nemƒõn√≠, *frameworky* ano
- nutnost zn√°t **specifick√© detaily** konkr√©tn√≠ch *framework≈Ø* (*syntax* ap.)
- nauƒçit se *framework* p≈ôedstavuje **investici**, kter√° d≈ô√≠ve nebo pozdƒõji p≈ôijde vniveƒç
- **omezuj√≠** poƒçet mo≈æn√Ωch ≈ôe≈°en√≠
- v p≈ô√≠padƒõ nep≈ôedv√≠dan√Ωch probl√©m≈Ø je t≈ôeba **obch√°zet** doporuƒçen√© postupy
- probl√©m s dlouhodobou **podporou**

---  <!-- .slide: class="longform" -->

### Frameworky IV.

- *frameworky* maj√≠ obrovsk√© v√Ωhody, ale nejsou v≈°el√©k
- prioritou by mƒõlo b√Ωt ovl√°dnout **jazyk** a **n√°vrhov√© vzory**
- ide√°lnƒõ zapojit a≈æ tehdy, kdy≈æ m√°m p≈ôedstavu, co jejich pou≈æit√≠m **z√≠sk√°m** a **ztrat√≠m**
- nauƒçit se rozpoznat **principy**, na kter√Ωch jednotliv√© *frameworky* stav√≠ a umƒõt je **porovnat**
- v√Ωvoj v JavaScriptu bez *frameworku* vy≈æaduje znaƒçnou **zku≈°enost** a **discipl√≠nu**, a v dne≈°n√≠ dobƒõ je nepopul√°rn√≠

---

### Knihovny I.

- *frameworky* se pot√Ωkaj√≠ s **architekturou** a **≈æivotn√≠m cyklem** cel√© aplikace
- knihovny ≈ôe≈°√≠ (ide√°lnƒõ jeden) **konkr√©tn√≠ probl√©m**, ale nenut√≠ k jedn√© architektu≈ôe
- knihovny se daj√≠ **skl√°dat** dohromady dle pot≈ôeb dan√©ho projektu

---

### Knihovny II.

- [*jQuery*](https://jquery.com) (manipulace nad *DOM*)
```js
$('.button').toggleClass('active');
```

- [*Lodash*](https://lodash.com) (*utility*)
```js
_.intersection([2, 1], [2, 3]);
```

- [*Ramda*](https://ramdajs.com) (funkcion√°ln√≠ programov√°n√≠)
```js
let add = R.curry((x, y) => x + y);
```

- [*Immutable.js*](https://facebook.github.io/immutable-js/) (nemƒõnn√© struktury)
```js
let list = List([ 1, 2 ]);
```
---

### Knihovny III.

- nƒõkter√© ‚Äû*frameworky*‚Äú jsou ve skuteƒçnosti **ekosyst√©my** sp≈ô√≠znƒõn√Ωch **knihoven**
- p≈ô√≠kladem je *React* nebo *Vue*
- *React* ≈ôe≈°√≠ **konkr√©tn√≠** probl√©m: front-endov√© komponenty a souvisejic√≠ manipulace nad *DOM*
- lze **roz≈°i≈ôovat** dle pot≈ôeby:
    - *Redux* (*state managment*)
    - *React Router* (*routing*)
    - ...

---

### React I.

```jsx
import React from 'react';

function Timer() {
    return <p>ETA: 10</p>
}

export default Timer;
```

```html
<Timer />
```

- *React* pou≈æ√≠v√° tzv. *JSX* syntax
- *transpilace* pomoc√≠ `@babel/preset-react`

```js
function Timer() {
    return React.createElement('p', null, 'ETA: 10');
}
```

---  <!-- .slide: class="longform" -->

### React II.

- chceme-li komponentu **nastavit**, pou≈æijeme `props`
- v r√°mci *JSX* bloku se `{}` **interpretuje**

```jsx
function Timer(props) {
    return <p>ETA: {props.count}</p>
}
```

```html
<Timer count="100" />
```

- `props` jsou **vnƒõj≈°√≠** vstup
- z pohledu komponenty je nelze mƒõnit, pouze **ƒç√≠st** (*read-only*)
- komponenty jsou s ohledem na `props` ***pure*** funkce

---

### React III.

Podobnƒõ jako v p≈ô√≠padƒõ `${...}` v r√°mci ``` `...` ``` (*template literal*) m≈Ø≈æe b√Ωt uvnit≈ô `{...}` jak√Ωkoliv **v√Ωraz**, vƒçetnƒõ dal≈°√≠ho *JSX*:

```jsx
function Timer(props) {
    let { count } = props;

    return <p>
        ETA: {count > 0 ? <time>{count + 's'}</time> : 'N/A'}
    </p>;
}
```

---

### React IV.

- komponenty lze definovat pomoc√≠ `class`
- oproti jednoduch√© funkci umo≈æ≈àuje nastavit dal≈°√≠ **metody**
- komponenta mus√≠ m√≠t alespo≈à metodu `render()`:

```jsx
import React from 'react';

class Timer extends React.Component {
    render() {
        return <p>ETA: {this.props.count}</p>
    }
}

export default Timer;
```

---

### React V.

- vnƒõj≈°√≠ vstup m≈Ø≈æe b√Ωt **dynamick√Ω**
- zmƒõn√≠-li se `props`, funkce se znovu **vykon√°**
- dojde k **p≈ôekreslen√≠** komponenty

```js
let count = 10;

setInterval(function() {
    if (count > 0) count--;
}, 1000);
```

```jsx
<Timer count={count} />
```

---

### React VI.

- komponenta m≈Ø≈æe m√≠t vlastn√≠ **vnit≈ôn√≠** stav (`state`)
- `state` je k dispozici jen v p≈ô√≠padƒõ `class`
- jeho prvotn√≠ hodnotu nastav√≠me v **konstruktoru**
- konstruktor se zavol√° jen **jednou**

```jsx
class Timer extends React.Component {
    constructor(props) {
        super(props);
        this.state = { count: props.count };
    }

    render() {
        return <p>ETA: {this.state.count}</p>
    }
}
```

---

### React VII.

- zmƒõny v `props` se neprop√≠≈°ou do vnit≈ôn√≠ho stavu
- √∫pravy stavu mus√≠ ≈ôe≈°it samotn√° komponenta na z√°kladƒõ **vnit≈ôn√≠** logiky nebo **interakce**
- lze pou≈æ√≠t tzv. ***life-cycle*** metody
- `componentDidMount()` se zavol√°, kdy≈æ se komponenta stane **souƒç√°st√≠** *DOM*
- `componentWillUnmount()` nebo `shouldComponentUpdate()` jsou dal≈°√≠ p≈ô√≠klady *life-cycle* metod

---

### React VIII.

```jsx
class Timer extends React.Component {
    ...

    componentDidMount() {
        setInterval(() => this.setState(state => ({
            count: (state.count > 0) ? state.count-- : 0
        })), 1000);
    }
}
```

- stav se mƒõn√≠ pomoc√≠ metody `setState()`, jej√≠m≈æ vstupem je *callback* funkce
- funkce obdr≈æ√≠ st√°vaj√≠c√≠ `state` jako parametr
- vr√°cen√Ω objekt je **vlo≈æen** (*merged*) do `state`
- mimo konstruktor nelze upravovat `state` **p≈ô√≠mo**

---

### React IX.

```jsx
class Timer extends React.Component {
    ...

    reset(ev) {
        ev.preventDefault();
        this.setState(() => ({ count: this.props.count }));
    }

    render() {
        return <button onClick={this.reset.bind}>
            ETA: {this.state.count}
        </button>
    }
}
```

- ud√°losti se odchyt√°vaj√≠ pomoc√≠ funkc√≠ na **atributech** jako `onClick`, `onSubmit`, ap.
- `ev` nen√≠ nativn√≠ objekt, ale `SyntheticEvent`

---

### React X.

- komponenta nen√≠ referenc√≠ na ***DOM* element**
- pot≈ôebujeme-li referenci, mus√≠me pou≈æ√≠t `React.createRef()`

```jsx
class Timer extends React.Component {
    ...

    constructor(props) {
        ...
        this.btn = React.createRef();
    }

    render() {
        return <button type="button" ref={this.btn}>
            ETA: {this.state.count}
        </button>
    }
}
```

---

### React XI.

- referenci na ***DOM* element** z√≠sk√°me a≈æ vol√°n√≠m `current` nad `ref`
- hod√≠ se v p≈ô√≠padƒõ, kdy pot≈ôebujeme reagovat na ud√°lost, kter√° nem√° **ekvivalent** v atributech typu `onClick` nebo z√≠skat **hodnotu** konkr√©tn√≠ho atributu

```jsx
class Timer extends React.Component {
    ...

    componentDidMount() {
        this.btn.current.addEventListener('oddEvent', ...);
    }
}
```

---

### React XII.

```jsx
class Timer extends React.Component {
    ...

    constructor(props) {
        super(props);
        this.reset = this.reset.bind(this);
    }
}
```

- pomoc√≠ `bind()` nastav√≠me metod√°m pevnou referenci na **komponentu** v r√°mci `this`
- hod√≠ se i v p≈ô√≠padƒõ, kdy metody **p≈ôed√°v√°me** pomoc√≠ `props` jin√Ωm komponent√°m a chceme zachovat **p≈Øvodn√≠** referenci
- lep≈°√≠ volat `bind()` v konstruktoru ne≈æ v `render()`

---

### React XIII.

**V√Ωhody:**

- vede k tvorbƒõ mal√Ωch **komponent**
- komponenty definujeme **deklarativnƒõ**
- p≈ô√≠m√° manipulace nad *DOM* je **skryt√°**
- zmƒõny v *DOM* jsou **optimalizovan√©** d√≠ky *Virtual DOM*
- **nevy≈æaduje** konkr√©tn√≠ architekturu aplikace

---

### React XIV.

**Nev√Ωhody:**

- **speci√°ln√≠** syntax (*JSX*)
- **vy≈æaduje** transpilaci
- zvy≈°uje **komplexitu** projektu
- p≈ô√≠m√° interakce nad *DOM* je tƒõ≈ækop√°dn√°

---  <!-- .slide: class="longform" -->

### Redux I.

- *React* se zab√Ωv√° pouze *view* vrstvou
- *Redux* ≈ôe≈°√≠ **spr√°vu stavu aplikace** (*state managment*)
- narozd√≠l od vƒõt≈°iny implementac√≠ *MVC* maj√≠ jednotliv√© ƒç√°sti aplikace jasnou **roli**
- vede k jednoduch√© a p≈ôedv√≠dateln√© **propagaci zmƒõn**
- zmƒõny stavu mohou nastat **pouze** p≈ôedem dan√Ωm a jasnƒõ urƒçen√Ωm zp≈Øsobem
- jde sp√≠≈°e o **sadu princip≈Ø** ne≈æ knihovnu

---

### Redux II.

Architektura *Reduxu* je zalo≈æena na t≈ôech **konceptech**:

- *Store*
- *Actions*
- *Reducers*

---

### Redux III.

***Store*** p≈ôedstavuje **stav** cel√© aplikace v podobƒõ **objektu**:

```js
{
    todos: [
        {
            text: 'Eat pizza',
            completed: true
        }, {
            text: 'Exercise',
            completed: false
        }
    ],
    visibility: 'SHOW_COMPLETED'
}
```

---

### Redux IV.

- *store* je jedin√Ω **zdroj pravdy** (*single source of truth*)
- stav aplikace je v ka≈æd√Ω moment jasnƒõ **dan√Ω**
- umo≈æ≈àuje jednoduch√Ω ***debugging***
- lze jej snadno **serializovat**
- nesm√≠ se upravovat p≈ô√≠mo, pouze **ƒç√≠st** (*read-only*)
- √∫pravy mohou nastat pouze na z√°kladƒõ **akc√≠** (*action*)

---

### Redux V.

***Action*** je **objekt**, kter√Ω popisuje **zmƒõnu** stavu:

```js
{ type: 'ADD_TODO', text: 'Eat more pizza' }
```

```js
{ type: 'COMPLETE_TODO', index: 1 }
```

```js
{ type: 'SET_VISIBILITY_FILTER', filter: 'SHOW_ALL' }
```

- akce samy o sobƒõ nic **nedƒõlaj√≠**
- jde o jednoduch√© objekty, lze je tedy snadno **serializovat**

---

### Redux VI.

***Reducer*** je funkce, kter√° na z√°kladƒõ **stavu** a **akce** vrac√≠ **nov√Ω stav**:

```js
function todos(state = [], action) {
    switch (action.type) {
        case 'ADD_TODO':
            return state.concat({
                text: action.text, completed: false
            });
        case 'COMPLETE_TODO':
            return state.map((todo, i) =>
                (i === action.index)
                    ? { ...todo, completed: true } : todo);
        default:
            return state;
    }
}
```

---

### Redux VII.

- *reducer* mus√≠ b√Ωt ***pure*** funkce:
    - nesm√≠ m√≠t **vedlej≈°√≠ √∫ƒçinky**
    - pro dan√Ω vstup mus√≠ v≈ædy vracet **stejn√Ω v√Ωstup**
- nikdy **neupravuje** `state`, ale vrac√≠ **nov√Ω objekt**
- vy≈æaduje pou≈æit√≠ `concat()`, `map()`, `...`, ap.
- mus√≠ umƒõt reagovat na **jakoukoliv** akci:

```js
default:
    return state;
```

- je t≈ôeba definovat **prvotn√≠ stav**:

```js
function todos(state = [], action) { ... }
```

---

### Redux VIII.

Ka≈æd√° ‚Äûvƒõtev‚Äú ve *store* m√° **vlastn√≠** *reducer*:

```js
function visibility(state = 'SHOW_ALL', action) {
    switch (action.type) {
        case 'SET_VISIBILITY_FILTER':
            return action.filter;
        default:
            return state;
    }
}
```

---

### Redux IX.

**Spojen√≠m** jednotliv√Ωch *reducer≈Ø* vznikne **aplikace**:

```js
function todoApp(state = {}, action) {
    return {
        todos: todos(state.todos, action),
        visibility: visibility(state.visibility, action)
    }
}
```

---

### Redux X.

*Redux* dod√°v√° u≈æiteƒçn√© funkce pro zprovoznƒõn√≠ tohoto **n√°vrhov√©ho vzoru**:

```js
import { combineReducers, createStore } from 'redux';

const reducer = combineReducers({ visibility, todos });
const store = createStore(reducer);
store.dispatch({ type: 'ADD_TODO', text: 'Buy groceries' });
store.getState();

/* {
 *    todos: [
 *        { text: 'Buy groceries', completed: false }
 *    ],
 *    visibility: 'SHOW_ALL'
 * }
 */
```

---

### React + Redux I.

- *React* ani *Redux* se vz√°jemnƒõ **nevy≈æaduj√≠**
- daj√≠ se pou≈æ√≠t **spoleƒçnƒõ** nebo **nez√°visle** na sobƒõ
- pro jejich **propojen√≠** je mo≈æn√© vyu≈æ√≠t *binding* knihovnu `react-redux` a funkci `connect()`:

```js
import { connect } from 'react-redux';
```

- bez `connect()` bychom museli `store` p≈ôed√°vat komponent√°m skrze `props`

---

### React + Redux II.

- `connect()` lze pou≈æ√≠t jako *dekor√°tor* (vy≈æaduje `@babel/plugin-proposal-decorators`)
- jej√≠m parametrem je *callback* funkce, kter√° dostane **aktu√°ln√≠ stav** `store` jako vstup:

```js
import React from 'react';
import { connect } from 'react-redux';

@connect(state => ({
    todos: state.todos,
    visibilityFilter: state.visibility
}))
class TodoList extends React.Component {
    ...
}
```

---

### React + Redux III.

- *callback* funkce vrac√≠ **objekt**, tzv. *store mapping*
- vybran√© prvky ze `state` se na z√°kladƒõ *mappingu* **prop√≠≈°ou** do `props`

```js
@connect(state => ({
    todos: state.todos,
    visibilityFilter: state.visibility
}))
class TodoList extends React.Component {
    constructor(props) {
        super(props);
        props.visibilityFilter; // "SHOW_ALL"
    }
}

export default TodoList;
```

---

### React + Redux IV.

V p≈ô√≠padƒõ, ≈æe nechci nebo nemohu pou≈æ√≠t `connect()` jako *dekor√°tor*, mus√≠m jej zavolat **ruƒçnƒõ** nad komponentou:

```jsx
class TodoList extends React.Component {
    ...
}

export default connect(state => ({
    todos: state.todos,
    visibilityFilter: state.visibility
}))(TodoList);
```

---

### React + Redux V.

- komponenty **napojen√©** na `store` se naz√Ωvaj√≠ *container components*
- ze `store` by mƒõly **odeb√≠rat** (*subscribe*) jen to nejnutnƒõj≈°√≠
- jak√°koliv zmƒõna v dan√© ƒç√°sti `store` se prop√≠≈°e do `props` a **automaticky** vyvol√° p≈ôekreslen√≠ (*render*)

---

### React + Redux VI.

- vƒõt≈°ina komponent **nepot≈ôebuje** p≈ô√≠stup ke `store`
- ‚Äûobyƒçejn√©‚Äú komponenty se naz√Ωvaj√≠ *presentational components*
- **pozor:** glob√°ln√≠ `store` a jeho `state` nesouvis√≠ s **vnit≈ôn√≠m stavem** komponenty `this.state`
- pokud data nevyu≈æ√≠v√° **v√≠ce** komponent, nepat≈ô√≠ do `store`, ale do `this.state`:

```js
class Accordion extends React.Component {
    constructor(props) {
        super(props);
        this.state = { isActive: false };
    }
}
```

---

### React + Redux VII.

- ke zmƒõnƒõ stavu mus√≠me vyvolat **akci**
- pro zpracov√°n√≠ akce pot≈ôebujeme `dispatch()`
- d√≠ky `connect()` obdr≈æ√≠me `dispatch()` v `props`:

```js
@connect(...)
class TodoList extends React.Component {

    addTodo() {
        this.props.dispatch({
            type: 'ADD_TODO',
            text: 'Eat pizza'
        });
    }
}
```

---

### React + Redux VIII.

- aby mohly komponenty p≈ôistupovat ke `store`, mus√≠me *Virtual DOM* obalit elementem `Provider`
- `render()` **vykresl√≠** aplikaci do dan√©ho elementu:

```js
// app.js
import React from 'react';
import { render } from 'react-dom';
import { Provider } from 'react-redux';
import { combineReducers, createStore } from 'redux';
...

const store = createStore(reducer);
render(
    <Provider store={store}>
        <TodoList />
    </Provider>,
    document.getElementById('root')
);
```

---

### React + Redux IX.

Je t≈ôeba vytvo≈ôit ***bundle*** (`js/app.bundle.js`) pro prohl√≠≈æeƒçe:

```html
<html>
    <head>
        <title>TodoList</title>
    </head>
    <body>
        <div id="root"></div>
        <script src="js/app.bundle.js" async></script>
    </body>
</html>
```

---

### React + Redux X.

- *bundle* m≈Ø≈æeme vytvo≈ôit pomoc√≠ *webpack*
- mus√≠me pou≈æ√≠t pot≈ôebn√© *presety* a *pluginy*, a p≈ôidat ***polyfilly*** dle c√≠lov√Ωch u≈æivatel≈Ø:

```js
// webpack.config.js
module.exports = {
  entry: ['./lib/promise.js', './src/js/app.js'],
  output: { filename: 'app.bundle.js' },
  module: {
    rules: [{
      loader: 'babel-loader',
      options: {
        presets: ['@babel/preset-env','@babel/preset-react'],
        plugins: ['@babel/plugin-proposal-decorators']
      }
    }]
  }
};
```

---

### Univerz√°ln√≠ aplikace I.

- *React* je ***single-page application*** *framework*
- server v r√°mci odpovƒõdi nepos√≠l√° **obsah**
- obsah se vykresl√≠ a≈æ v **prohl√≠≈æeƒçi** po naƒçten√≠ aplikace v *bundle* souboru
- dal≈°√≠ data aplikace z√≠sk√°v√° pomoc√≠ ***AJAX***
- zmƒõny v *DOM* jsou **postupn√©**

---

### Univerz√°ln√≠ aplikace II.

- pokud se z **jak√©hokoliv** d≈Øvodu aplikace nenaƒçte, je v√Ωsledkem **pr√°zdn√° str√°nka**
- *bundle* mus√≠ obsahovat spoustu *polyfill≈Ø* a *transpilace*, aby **podporoval** co nejv√≠ce u≈æivatel≈Ø
- v√Ωsledkem je velk√Ω soubor, kter√Ω se dlouho **stahuje** a **zpracov√°v√°** ‚Äî do t√© chv√≠le je str√°nka **pr√°zdn√°**

---

### Univerz√°ln√≠ aplikace III.

- server by mƒõl vracet **obsah**, kter√Ω d√°v√° smysl s√°m o sobƒõ a v z√°kladn√≠ podobƒõ funguje i **bez JavaScriptu**
- *single-page application* je **vylep≈°en√≠**
- *React* ‚Äûnavƒõs√≠me‚Äú na aplikaci **vykreslenou** u≈æ na serveru (*server-side rendering*)
- hlavn√≠ v√Ωhoda *Node.js* spoƒç√≠v√° ve **spoleƒçn√©m jazyku** a tedy potenci√°lnƒõ **sd√≠len√©m k√≥du**

---

### Univerz√°ln√≠ aplikace IV.

- aplikaci **rozdƒõl√≠me** do t≈ô√≠ slo≈æek: `client`, `server` a `common`
- v `client` z≈Østane *entry point* (`app.js`) na z√°kladƒõ kter√©ho vznikne *bundle* pro **prohl√≠≈æeƒç**
- v `server` vznikne skript pro spu≈°tƒõn√≠ *Node.js* serveru, kter√Ω bude umƒõt **vykreslit** celou aplikaci
- v≈°e ostatn√≠ (komponenty, akce, *reducery*, ap.) je **sd√≠len√©** a pat≈ô√≠ do slo≈æky `common`

---

### Univerz√°ln√≠ aplikace V.

- pomoc√≠ *express* vytvo≈ô√≠me jednoduch√Ω HTTP server
- *callback* funkce `function(req, res)` pro ka≈æd√Ω po≈æadavek vytvo≈ô√≠ odpovƒõƒè:

```js
// server/index.js
import express from 'express';

const app = express();

app.get('*', function(req, res) {
    ...
});

app.listen();
```

---

### Univerz√°ln√≠ aplikace VI.

- mimo *express* importujeme v≈°echny nutn√© z√°vislosti
- m√≠sto `render()` pou≈æijeme `renderToString()`:

```js
// server/index.js
import express from 'express';
import React from 'react';
import { Provider } from 'react-redux';
import { combineReducers, createStore } from 'redux';
import { renderToString } from 'react-dom/server';
import TodoList from '../common/components/TodoList';
import { todos, visibility } from '../common/reducers';

...
```

---

### Univerz√°ln√≠ aplikace VII.

- pro ka≈æd√Ω po≈æadavek vytvo≈ô√≠me **vlastn√≠** `store`
- do `initialState` ulo≈æ√≠me **serializovan√Ω** `state`
- vol√°n√≠m `renderToString()` nad aplikac√≠ z√≠sk√°me **HTML ≈ôetƒõzec**

```jsx
// server/index.js
function(req, res) {
    const reducer = combineReducers({ visibility, todos });
    const store = createStore(reducer);
    const initialState = JSON.serialize(store.getState());
    const appHtmlString = renderToString(
        <Provider store={store}>
            <TodoList />
        </Provider>
    );
}
```

---

### Univerz√°ln√≠ aplikace VIII.

- v HTML odpovƒõdi m√≠sto **pr√°zdn√©ho** elementu `#root` po≈°leme **vykreslenou** aplikaci
- do `window` ulo≈æ√≠me **serializovan√Ω** `state`

```js
// server/index.js
function(req, res) {
    ...

    res.send(`<html>
      <head>...</head>
        <body>
          <div id="root">${appHtmlString}</div>
          <script>window.__STATE = ${initialState};</script>
          <script src="js/app.bundle.js" async></script>
        </body>
    </html>`);
}
```

---

### Univerz√°ln√≠ aplikace IX.

- `app.js` mus√≠me upravit, aby umƒõlo pracovat s vykreslenou aplikac√≠
- m√≠sto `render()` pou≈æijeme `hydrate()`:

```js
// client/app.js
import React from 'react';
import { hydrate } from 'react-dom';
import { Provider } from 'react-redux';
import { combineReducers, createStore } from 'redux';
import TodoList from '../common/components/TodoList';
import { todos, visibility } from '../common/reducers';
```

---

### Univerz√°ln√≠ aplikace X.

- druh√Ω parametr `createStore()` umo≈æ≈àuje vlo≈æit alternativn√≠ **prvotn√≠ stav**
- pro **inicializaci** `store` pou≈æijeme `state` vlo≈æen√Ω serverem do `window.__STATE`
- pot√© m≈Ø≈æeme `state` **smazat** pro uvolnƒõn√≠ pamƒõti

```js
// client/app.js
...

const reducer = combineReducers({ visibility, todos });
const store = createStore(reducer, window.__STATE);

delete window.__STATE;
```

---

### Univerz√°ln√≠ aplikace XI.

- `hydrate()` narozd√≠l od `render()` p≈ôedpokl√°d√° **vykreslen√Ω obsah**
- na **existuj√≠c√≠** *DOM* ‚Äûnavƒõs√≠‚Äú aplikaci a p≈ôed√° ji kontrolu (odchyt√°v√°n√≠ ud√°lost√≠ ap.)

```js
// client/app.js
...

hydrate(
    <Provider store={store}>
        <TodoList />
    </Provider>,
    document.getElementById('root')
);
```

---

### Univerz√°ln√≠ aplikace XII.

- v√Ωsledkem je aplikace, kter√° ‚Äî v podstatƒõ **zadarmo** ‚Äî funguje v prohl√≠≈æeƒçi i bez JavaScriptu
- server i prohl√≠≈æeƒç **sd√≠l√≠** skoro v≈°echen k√≥d
- podm√≠nkou je dodr≈æen√≠ **principu postupn√©ho vylep≈°en√≠**
- m≈Ø≈æeme si dovolit **zv√Ω≈°it** po≈æadavky na podporovan√© prohl√≠≈æeƒçe
- vyhneme se zbyteƒçn√© *transpilaci* a *polyfill≈Ø*, a t√≠m **zmen≈°√≠me** a **zrychl√≠me** *bundle*

---

### Univerz√°ln√≠ aplikace XIII.

`preset-env` nastav√≠me tak, aby c√≠lilo jen na prohl√≠≈æeƒçe podporuj√≠c√≠ **nativn√≠ moduly**:

```js
// webpack.config.js
{
    loader: 'babel-loader',
    options: {
        presets: [
            [
                '@babel/preset-env',
                { targets: { esmodules: true } }
            ],
            '@babel/preset-react'
        ],
        plugins: ['@babel/plugin-proposal-decorators']
    }
}
```

```html
<script src="js/app.bundle.js" type="module"></script>
```

---

### Univerz√°ln√≠ aplikace XIV.

- pro √∫ƒçely **serveru** mus√≠me *transpilovat* **jednotliv√©** soubory, *bundle* se pou≈æije jen v prohl√≠≈æeƒçi
- pot≈ôebujeme v≈°echny soubory ze slo≈æek `server` a `common`
- *transpilaci* m≈Ø≈æeme prov√©st nap≈ô√≠klad pomoc√≠ *pluginu* `grunt-babel`

---

### Univerz√°ln√≠ aplikace XIV.

Konfigurace `grunt-babel` a nastaven√≠ **c√≠lov√©ho prost≈ôed√≠** (*Node.js*) pomoc√≠ `preset-env`:

```js
// Gruntfile.js
babel: {
    options: {
        presets: [
            [
                '@babel/preset-env',
                { targets: { node: 'current' } }
            ],
            '@babel/preset-react'
        ],
        plugins: ['@babel/plugin-proposal-decorators']
    }
}
```

---

### Univerz√°ln√≠ aplikace XV.

```js
// Gruntfile.js
babel: {
    ...
    server: {
        files: [{
            cwd: './src',
            expand: true,
            src: ['server/**/*.js', 'common/**/*.js'],
            dest: './build'
        }]
    }
}
```

```js
// package.json
"scripts": {
    "start": "node build/server/index.js"
}
```

```bash
npm run start
```

--- <!-- .slide: class="exercise" data-background="#b8f1fd" -->

## P≈ô√≠klad IV. ‚Äî [odkaz](https://repl.it/@jackdaw/exercise-pj-iv)

- v komponentƒõ `TodoList.js` implementujte funkce `addTodo`, `removeTodo` a `toggleFiltering`
- rozmyslete, kter√° data pat≈ô√≠ do *store* a kter√° do lok√°ln√≠ho stavu komponenty

=== <!-- .slide: class="section" data-background="#F5D76E" -->

# Progresivn√≠ webov√© aplikace

---

### Mobiln√≠ aplikace I.

- **nativn√≠** aplikace pro *Android* a *iOS*
- r≈Øzn√© **jazyky** a v√Ωvojov√° **prost≈ôed√≠**:
    - *Android*: *Java*, *Kotlin*, *C*, *C++*, *C#*
    - *iOS*: *Objective-C*, *Swift*


---

### Mobiln√≠ aplikace II.

**V√Ωhody:**
- **rychl√Ω** chod a interakce
- vyu≈æ√≠v√° **nativn√≠ho rozhran√≠** a prvk≈Ø
- integrace na √∫rovni syst√©mu (**notifikace** ap.)
- **jednoduch√°** spr√°va a nastaven√≠
- **instalace** na plochu
- p≈ô√≠stup k **nativn√≠m** ***API*** za≈ô√≠zen√≠ a jeho *hardwaru*

---

### Mobiln√≠ aplikace III.

**Nev√Ωhody:**
- **drah√Ω** v√Ωvoj
- **nekompatibiln√≠** k√≥d nap≈ô√≠ƒç platformami
- **z√°vislost** na *Play Store* a *App Store*
- **poplatky** za **√∫ƒçast** na tr≈æi≈°ti a ka≈æd√Ω **prodej** aplikace
- t≈ôeba poƒç√≠tat s obrovskou **konkurenc√≠** na tr≈æi≈°t√≠ch
- pomal√° **aktualizace** z√°visl√° na specifick√©m procesu **schvalov√°n√≠**

---

### Mobiln√≠ aplikace IV.

- pomoc√≠ `WebView` lze pou≈æ√≠t **webov√© technologie** a ‚Äûzabalit‚Äú je do podoby **nativn√≠** aplikace
- sni≈æuje **cenu** a **komplexitu** v√Ωvoje mobiln√≠ch aplikac√≠
- umo≈æ≈àuj√≠ rychlej≈°√≠ **aktualizaci** skrze webovou vrstvu
- z√°rove≈à kombinuj√≠ nƒõkter√© **nedostatky** obou svƒõt≈Ø:
    - z√°vislost na tr≈æi≈°t√≠ch
    - ‚Äûpomal√©‚Äú interakce

---

### Mobiln√≠ aplikace V.

- *React Native* umo≈æ≈àuje v√Ωvoj ƒçistƒõ v *JavaScriptu*
- zalo≈æen√© na stejn√Ωch **principech** jako *React*
- na z√°kladƒõ *Virtual DOM* generuje **nativn√≠** prvky rozhran√≠:

```jsx
import React from 'react';
import { AppRegistry, Text } from 'react-native';

class HelloWorldApp extends Component {
    render() {
        return <Text>Hello world!</Text>;
    }
}

AppRegistry.registerComponent('HelloWorld', HelloWorldApp);
```

---

### Mobiln√≠ web I.

- mobiln√≠ za≈ô√≠zen√≠ p≈ôedstavuj√≠ skoro **p≈Ølku** v≈°ech p≈ô√≠stup≈Ø a jejich poƒçet **vzr≈Øst√°**
- s n√°stupem **responzivn√≠ho** webu do≈°lo ke slouƒçen√≠ *desktopov√©* a mobiln√≠ verze
- na **mobiln√≠ *user experience*** (*UX*) se kladou vysok√© n√°roky a mnohdy vƒõt≈°√≠ d≈Øraz ne≈æ na *UX* na *desktopu*:
    - monitor a **vy≈°≈°√≠ rozli≈°en√≠** p≈ôedstavuje **vylep≈°en√≠**, ne nutnou podm√≠nku (princip ***mobile first***)
    - to sam√© plat√≠ pro rychlost (a stav) **p≈ôipojen√≠** k internetu (princip ***offline first***)

---

### Mobiln√≠ web II.

**V√Ωhody:**
- **jednoduch√©** a **stabiln√≠** technologie (*HTML*, *CSS*, ap.)
- jedna aplikace dok√°≈æe pokr√Ωt r≈Øzn√© **typy p≈ô√≠stup≈Ø** (*desktop*, mobiln√≠ za≈ô√≠zen√≠)
- **nez√°vislost** na platform√°ch a za≈ô√≠zen√≠ch
- bƒõ≈æ√≠ **v≈°ude** tam, kde je k dispozici **prohl√≠≈æeƒç**
- umo≈æ≈àuje okam≈æit√© **aktualizace**
- jednoduch√° **distribuce** a **sd√≠len√≠** (*URL*)

---

### Mobiln√≠ web III.

**Nev√Ωhody:**
- vy≈æaduje **p≈ôipojen√≠** k internetu
- *cache* v prohl√≠≈æeƒçi je **nespolehliv√°**
- z√°visl√© na **prohl√≠≈æeƒçi** a jeho rozhran√≠
- absence klasick√© **instalace**

---

### Progresivn√≠ webov√° aplikace I.

- *progressive web application* (*PWA*)¬†je sada **technologi√≠, postup≈Ø a doporuƒçen√≠**
- s jejich pomoc√≠ jde v **prohl√≠≈æeƒçi** vytvo≈ôit ***UX*** schopn√© **konkurovat** nativn√≠m aplikac√≠m
- lze je aplikovat na ji≈æ existuj√≠c√≠ webovou aplikaci
- kompatibiln√≠ s **principem postupn√©ho vylep≈°en√≠**
- nutnou podm√≠nkou je ***responzivn√≠*** web a pou≈æit√≠ ***HTTPS***

---

### Progresivn√≠ webov√° aplikace II.

*PWA* se zamƒõ≈ôuje na **oblasti** a **situace**, ve kter√Ωch klasick√Ω web **zaost√°v√°** za nativn√≠mi aplikacemi:
- **instalace** a spr√°va
- z√°vislost na **prohl√≠≈æeƒçi**
- **pomal√©** nebo **nefunkƒçn√≠** p≈ôipojen√≠ k internetu
- notifikace

---

### Progresivn√≠ webov√° aplikace III.

*Web app manifest* umo≈æ≈àuje definovat ***metadata*** webov√© aplikace:

```json
{
    "name": "Financial Times",
    "short_name": "FT",
    "start_url": "/index.html",
    "background_color": "#9f0c3f",
    "theme_color": "#fff1e0",
    "display": "standalone",
    "icons": [{
        "src": "/img/icon.png",
        "sizes": "192x192"
    }]
}
```

```html
<link rel="manifest" href="manifest.json">
```

---

### Progresivn√≠ webov√° aplikace IV.

<img src="img/ft.png" style="height: 50vh; float: right; margin-left: 1em">

Pokud web spl≈àuje z√°kladn√≠ **po≈æadavky** (*HTTPS*, `manifest.json`, atd.) a u≈æivatel jej za urƒçitou dobu **v√≠cekr√°t** nav≈°t√≠v√≠, nab√≠dne prohl√≠≈æeƒç **instalaci**.

Po ‚Äûinstalaci‚Äú je webov√° aplikace um√≠stƒõna na plo≈°e stejnƒõ jako **nativn√≠ aplikace** a lze ji skrze syst√©m spravovat a odstranit.

---

### Progresivn√≠ webov√° aplikace V.

- pole `icons` definuje **ikony** pro r≈Øzn√° rozli≈°en√≠
- `short_name` ud√°v√° **popisek** pod ikonou
- `start_url` je URL, kter√© se spust√≠ po **otev≈ôen√≠**
- `display` umo≈æ≈àuje nastavit **rozhran√≠** aplikace:
    - `fullscreen` nebo `standalone` znaƒç√≠, ≈æe web pobƒõ≈æ√≠ s **≈æ√°dn√Ωm** nebo **minim√°ln√≠m** viditeln√Ωm rozhran√≠m prohl√≠≈æeƒçe
    - `browser` zobraz√≠ klasick√© rozhran√≠ prohl√≠≈æeƒçe
- `theme_color` lze pou≈æ√≠t pro nastaven√≠ barvy rozhran√≠ prohl√≠≈æeƒçe v p≈ô√≠padech, kdy je viditeln√©

---

### *Service Worker* I.

Jedna z **podm√≠nek** *PWA* je *service worker*:
- speci√°ln√≠ **skript**, kter√Ω instalujeme pro dan√Ω web
- po instalaci bƒõ≈æ√≠ v **pozad√≠** a **vlastn√≠m vl√°knƒõ**
- je **nez√°visl√Ω** na webov√© str√°nce a prohl√≠≈æeƒçi
- operuje jako ***proxy***:
    - nem√° p≈ô√≠stup k samotn√©mu webu a jeho *DOM*
    - odchyt√°v√° **po≈æadavky** na server a jeho **odpovƒõdi**
    - m≈Ø≈æe po≈æadavky a odpovƒõdi **upravovat** a dokonce **vytv√°≈ôet** vlastn√≠

---

### *Service Worker* II.

```html
<script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register(
            './service-worker.js',
            { scope: '/foo' }
        )
            .then(registration => {
                console.log('Service Worker registered!');
            });
    }
</script>
```

- skript se st√°hne a instaluje jen **jednou**
- k nov√©mu sta≈æen√≠ a registraci dojde a≈æ p≈ôi zmƒõnƒõ **obsahu** nebo **n√°zvu** souboru
- `scope` omez√≠ *URL*, na kter√° *service worker* **reaguje**

---

### *Service Worker* III.

```js
// service-worker.js
const CACHE_NAME = 'my-cache-v2';
const FILES_TO_CACHE = ['css/default.css', 'js/app.js'];

self.addEventListener('install', ev => {
    ev.waitUntil(
        return caches.open(CACHE_NAME)
            .then(cache => cache.addAll(FILES_TO_CACHE));
    );
});
```

- p≈ôi registraci dojde k ud√°losti `install`
- pomoc√≠ `caches` m≈Ø≈æeme do **pojmenovan√©** *cache* ruƒçnƒõ vlo≈æit **konkr√©tn√≠** soubory
- `ev.waitUntil()` zajist√≠, ≈æe se nevykon√° ≈æ√°dn√Ω dal≈°√≠ k√≥d, dokud se **nevyhodnot√≠** *Promise* uvnit≈ô

---

### *Service Worker* IV.

```js
self.addEventListener('activate', ev => {
  ev.waitUntil(
    caches.keys().then(cacheNames => Promise.all(
      cacheNames.map(cacheName => {
        if (cacheName !== CACHE_NAME) {
          return caches.delete(cacheName);
        }
      })
    ));
  );
});
```

- bƒõhem ud√°losti `activate` m≈Ø≈æeme **promazat** nepou≈æ√≠van√© *cache*
- k zavol√°n√≠ `activate` dojde hned po `install`, pokud nen√≠ aktivn√≠ **p≈ôedchoz√≠** verze *service worker*

---

### *Service Worker* V.

```js
self.addEventListener('fetch', ev => {
    ev.respondWith(caches.open(CACHE_NAME)
        .then(cache => cache.match(ev.request))
        .then(matchingRes => {
            if (matchingRes) return matchingRes;

            return fetch(ev.request).then(res => {
                cache.put(ev.request, res.clone());
                return res;
            });
        }));
});
```

- je-li po≈æadovan√Ω soubor (`ev.request`) v *cache*, **okam≈æitƒõ** jej vr√°t√≠me
- pokud ne, **p≈ôepo≈°leme** po≈æadavek na server a odpovƒõƒè p≈ôes odesl√°n√≠m klientovi ulo≈æ√≠me v *cache*

---

### *Service Worker* VI.

- *service worker* umo≈æ≈àuje aplikaci √∫ƒçinnƒõ **reagovat** na **rychlost** nebo **absenci** p≈ôipojen√≠
- nab√≠z√≠ absolutn√≠ **kontrolu** nad stavem *cache* a zpracov√°n√≠m po≈æadavk≈Ø
- d√°v√° k dispozici ≈ôadu **optimalizac√≠** a **sc√©n√°≈ô≈Ø**:
    - *cache only*
    - *cache and update*
    - *cache, update and refresh*
    - dal≈°√≠ p≈ô√≠klady na [*Service Worker Cookbook*](https://serviceworke.rs/)
- **knihovna** pro usnadnƒõn√≠ ‚Äî [*Workbox*](https://developers.google.com/web/tools/workbox/)

---

### *Service Worker* VII.

<img src="img/caniuse-serviceworker.png">

---

### Notifikace I.

- webov√© aplikace m≈Ø≈æou zobrazit **notifikaci** jen v momentƒõ, kdy jsou **otev≈ôen√©** v prohl√≠≈æeƒçi
- notifikace na √∫rovni **syst√©mu** bez otev≈ôen√©ho prohl√≠≈æeƒçe vy≈æaduje:
    - **opr√°vnƒõn√≠** od u≈æivatele
    - aplikaƒçn√≠ server pro **pos√≠l√°n√≠** notifikac√≠
    - *push* server pro jejich **p≈ô√≠jem**
    - *service worker* pro jejich **zobrazen√≠**

---

### Notifikace II.

```js
navigator.serviceWorker.register('./service-worker.js')
    .then(registration => {
        Notification.requestPermission().then(result => {
            if (result !== 'granted') return;

            let options = { applicationServerKey: 'RfS...' };
            registration.pushManager.subscribe(options)
                .then(subscription => {
                    ...
                });
        })
    });
```

- `applicationServerKey` je **ve≈ôejn√Ω** kl√≠ƒç aplikaƒçn√≠ho serveru
- s pomoc√≠ `subscription` lze u≈æivateli pos√≠lat notifikace

---

### Notifikace III.

```json
{
    "endpoint": "https://fcm.googleapis.com/fcm/send/c7V...",
    "expirationTime": null,
    "keys": {
        "p256dh": "BJs...",
        "auth": "TJX..."
    }
}
```

- `endpoint` je **unik√°tn√≠** URL *push serveru* pro dan√©ho u≈æivatele
- `subscription` **po≈°leme** aplikaƒçn√≠mu serveru a **ulo≈æ√≠me** do datab√°ze

---

### Notifikace IV.

Aplikaƒçn√≠ server se u *push* serveru **identifikuje** pomoc√≠ *VAPID* protokolu a vygenerovan√©ho p√°ru kl√≠ƒç≈Ø:

```js
import webpush from 'web-push';

const vapidKeys = webpush.generateVAPIDKeys();
```

---

### Notifikace V.

```js
import webpush from 'web-push';

let options = {
    vapidDetails: { ... }
};

let data = {
    title: 'Delivery update',
    body: 'Your pizza is ready!'
};

webpush.sendNotification(subscription, data, options);
```

- ulo≈æen√© `subscription` pou≈æijeme pro odesl√°n√≠ notifikace
- d√≠ky `vapidDetails` *push* server **ovƒõ≈ô√≠**, ≈æe po≈æadavek poch√°z√≠ z na≈°eho aplikaƒçn√≠ho serveru

---

### Notifikace VI.

V p≈ô√≠padƒõ `push` ud√°losti se *service worker* ‚Äûprobud√≠‚Äú a zobraz√≠ **syst√©movou** notifikaci:

```js
self.addEventListener('push', ev => {
    let { title, body } = ev.data;
    let options = { body, icon: 'img/badge.png' };

    ev.waitUntil(
        self.registration.showNotification(title, options);
    );
});
```

--- <!-- .slide: class="title" data-background="#F5D76E" -->

## Dƒõkuji za pozornost!
